<ion-header>
  <ion-toolbar>
    <ion-title>PreçoLeite</ion-title>
    <ion-buttons slot="end">
      <ion-menu-button autoHide="false"></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-text color="medium">
    <h2 style="margin-top: 24px;">Cadastro da Propriedade</h2>
  </ion-text>

  <!-- Nome da Propriedade -->
  <ion-item>
    <ion-input
      [(ngModel)]="nomePropriedade"
      placeholder="Nome da Propriedade">
    </ion-input>
  </ion-item>

  <!-- Município -->
  <ion-item button (click)="abrirModalMunicipios()">
    <ion-label position="stacked">Município</ion-label>
    <ion-input
      [value]="municipio"
      placeholder="Selecionar"
      readonly>
    </ion-input>
  </ion-item>

  <!-- Modal Municípios -->
  <ion-modal [isOpen]="modalAberto" (didDismiss)="modalAberto = false">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>Selecionar Município</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="modalAberto = false">
              Fechar
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content>

        <ion-searchbar
          placeholder="Buscar município..."
          [(ngModel)]="filtroMunicipio"
          (ionInput)="filtrarMunicipios()">
        </ion-searchbar>

        <ion-list>
          <ion-item
            button
            *ngFor="let m of municipiosFiltrados"
            (click)="selecionarMunicipio(m.nome)">
            {{ m.nome }}
          </ion-item>
        </ion-list>

      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- ================= REGIÃO / POVOADO ================= -->

  <!-- Se for Orizona -->
  <ng-container *ngIf="municipio?.toLowerCase() === 'orizona'; else campoRegiaoNormal">

    <!-- Select padrão -->
    <ion-item *ngIf="!modoManualPovoado">
      <ion-label position="stacked">Povoado</ion-label>
      <ion-select
        [(ngModel)]="povoado"
        placeholder="Selecione o povoado">

        <ion-select-option
          *ngFor="let p of povoadoOrz"
          [value]="p">
          {{ p }}
        </ion-select-option>

      </ion-select>
    </ion-item>

    <!-- Botão liberar digitação -->
    <ion-button
      *ngIf="!modoManualPovoado"
      fill="clear"
      size="small"
      (click)="modoManualPovoado = true">
      Não encontrei meu povoado
    </ion-button>

    <!-- Input manual -->
    <ion-item *ngIf="modoManualPovoado">
      <ion-label position="stacked">Povoado</ion-label>
      <ion-input
        [(ngModel)]="povoado"
        placeholder="Digite o povoado">
      </ion-input>
    </ion-item>

  </ng-container>

  <!-- Se NÃO for Orizona -->
  <ng-template #campoRegiaoNormal>
    <ion-item>
      <ion-label position="stacked">Povoado</ion-label>
      <ion-input
        [(ngModel)]="regiao"
        placeholder="Digite o Povoado">
      </ion-input>
    </ion-item>
  </ng-template>

  <!-- Botão salvar -->
  <ion-button
    color="primary"
    expand="full"
    (click)="cadastrarPropriedade()">
    Salvar
  </ion-button>

  <p style="color:red">{{ erro }}</p>

</ion-content>
