<ion-header>
  <ion-toolbar>
    <ion-title>Pre√ßoLeite</ion-title>
    <ion-buttons slot="end">
      <ion-menu-button autoHide="false"></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- üîç Filtros -->
<ion-card>
  <ion-card-content>

    <!-- Filtro de Munic√≠pio -->
    <ion-item>
      <ion-label position="stacked">
        <ion-icon name="location-outline" slot="start" class="ion-margin-end"></ion-icon>
        Filtro por Munic√≠pio
      </ion-label>
      <ion-select [(ngModel)]="municipioSelecionado" placeholder="Selecione" interface="popover">
        <ion-select-option value="geral">Todos os Munic√≠pios</ion-select-option>
        <ion-select-option *ngFor="let m of municipiosDisponiveis" [value]="m">
          {{ m }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Filtro de M√™s -->
    <ion-item class="ion-margin-top">
      <ion-label position="stacked">
        <ion-icon name="calendar-outline" slot="start" class="ion-margin-end"></ion-icon>
        Filtro por M√™s
      </ion-label>
      <ion-select [(ngModel)]="mesReferencia" placeholder="Todos os Meses" interface="popover">
        <ion-select-option [value]="null">Todos os Meses</ion-select-option>
        <ion-select-option *ngFor="let mes of mesesDisponiveis" [value]="mes.valor">
          {{ mes.nome }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Segmento de agrupamento -->
    <ng-container *ngIf="municipioSelecionado">
      <ion-segment [(ngModel)]="agrupamentoSelecionado" class="ion-margin-top">
        <ion-segment-button value="laticinio">
          <ion-label>Latic√≠nio</ion-label>
        </ion-segment-button>
        <ion-segment-button value="mes">
          <ion-label>M√™s</ion-label>
        </ion-segment-button>
        <ion-segment-button value="regiao">
          <ion-label>Regi√£o</ion-label>
        </ion-segment-button>
      </ion-segment>
    </ng-container>

  </ion-card-content>
</ion-card>

  <!-- Por Regi√£o -->
  <ng-container *ngIf="agrupamentoSelecionado === 'regiao'">
    <ion-text color="medium">
      <h2 style="margin: 16px 0 8px;">M√©dia de Pre√ßo por Regi√£o</h2>
    </ion-text>

    <ion-card *ngFor="let grupo of dadosPorRegiao; trackBy: trackByLaticinio">
      <ion-card-header>
        <ion-card-title>
          {{ grupo.regiao }} ‚Äî M√©dia Geral: R$ {{ grupo.mediaPreco | number:'1.2-2' }}
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item *ngFor="let lat of grupo.laticinios; trackBy: trackByFaixa">
          <ion-label>{{ lat.laticinio }}</ion-label>
          <ion-note slot="end">R$ {{ lat.mediaPreco | number:'1.2-2' }}</ion-note>
        </ion-item>
      </ion-card-content>
    </ion-card>

   <ion-card>
  <ion-card-header>
    <ion-card-title>
      Gr√°fico por Regi√£o
      <span *ngIf="municipioSelecionado && municipioSelecionado !== 'geral'">
        ‚Äî {{ municipioSelecionado }}
      </span>
      <span *ngIf="mesReferencia">
        ({{ obterNomeMes(mesReferencia) }})
      </span>
    </ion-card-title>
  </ion-card-header>
  <ion-card-content>
    <canvas #graficoRegiao style="width: 100%; max-width: 600px; height: 300px;"></canvas>
  </ion-card-content>
</ion-card>
  </ng-container>

  <!-- Por Latic√≠nio -->
  <ng-container *ngIf="agrupamentoSelecionado === 'laticinio'">
    <ion-text color="medium">
      <h2 style="margin: 16px 0 8px;">M√©dia de Pre√ßo por Faixas</h2>
    </ion-text>

    <ion-card *ngFor="let grupo of dadosPorLaticinioFaixas; trackBy: trackByLaticinio">
      <ion-card-header>
        <ion-card-title>Latic√≠nio: {{ grupo.laticinio }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item *ngFor="let faixa of grupo.faixas; trackBy: trackByFaixa">
          <ion-label>
            Litros: {{ faixa.faixa }} ‚Äî M√©dia Pre√ßo: R$ {{ faixa.mediaPreco | number:'1.2-2' }}
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Comparativo Intervalo e Pre√ßos</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <canvas id="graficoLitrosPreco" style="width: 100%; max-width: 600px; height: 300px;"></canvas>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <!-- Por M√™s -->
  <ng-container *ngIf="agrupamentoSelecionado === 'mes'">
    <ion-text color="medium">
      <h2 style="margin: 16px 0 8px;">M√©dia de Pre√ßo por M√™s</h2>
    </ion-text>

    <ion-card *ngFor="let grupo of dadosPorMes; trackBy: trackByLaticinio">
      <ion-card-header>
        <ion-card-title>{{ grupo.mes }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item *ngFor="let item of grupo.items; trackBy: trackByFaixa">
          <ion-label>
            {{ item.laticinio }}<br>
            M√©dia Geral: R$ {{ item.mediaPrecoDoLaticinio | number:'1.2-2' }}
          </ion-label>
          <ion-note slot="end">R$ {{ item.precoLitro | number:'1.2-2' }}</ion-note>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </ng-container>

</ion-content>
